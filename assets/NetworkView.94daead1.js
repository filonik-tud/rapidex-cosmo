import{N as Re,S as Gt,b as Vt,d as qt,K as Jt,f as Yt,o as Ae,c as Te,a as me,F as qe,x as Xt,T as ye,U as oe,q as Kt,y as Ht,h as Je,V as Qt,W as en,X as Ye,Y as tn,Z as nn,$ as on}from"./index.7a4453cf.js";import{a as rn,B as an}from"./mapbox-layer.23573ae4.js";import{n as sn,S as dn,P as tt,i as cn,e as Xe,f as ln,g as Q,h as he,s as y,l as z,d as Me,j as V,R as un,m as gn,k as fn,o as pn,p as mn,q as yn,t as hn,u as bn,v as vn}from"./loaders.3c5b3ddb.js";import{M as wn}from"./mapbox-overlay.e8df382f.js";import{S as _n}from"./scatterplot-layer.1f1d96a1.js";import{L as xn,f as Ln,i as Sn,_ as Fe,l as kn,c as zn}from"./layer.6384b77b.js";import"./phong-lighting.adf0dbf3.js";import"./objects.1ec32615.js";const Cn="compositeLayer.renderLayers";class nt extends xn{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:o}=this.props;return o&&o[e]&&o[e].type||t}getSubLayerRow(e,t,o){return e.__source={parent:this,object:t,index:o},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(o,s)=>o&&o.__source?(t.index=o.__source.index,e(o.__source.object,t)):e(o,s)}return e}getSubLayerProps(e={}){var t;const{opacity:o,pickable:s,visible:c,parameters:u,getPolygonOffset:x,highlightedObjectIndex:W,autoHighlight:v,highlightColor:b,coordinateSystem:w,coordinateOrigin:g,wrapLongitude:L,positionFormat:j,modelMatrix:Z,extensions:C,fetch:R,operation:A,_subLayerProps:X}=this.props,T={id:"",updateTriggers:{},opacity:o,pickable:s,visible:c,parameters:u,getPolygonOffset:x,highlightedObjectIndex:W,autoHighlight:v,highlightColor:b,coordinateSystem:w,coordinateOrigin:g,wrapLongitude:L,positionFormat:j,modelMatrix:Z,extensions:C,fetch:R,operation:A},N=X&&e.id&&X[e.id],K=N&&N.updateTriggers,S=e.id||"sublayer";if(N){const M=this.constructor._propTypes,h=e.type?e.type._propTypes:{};for(const q in N){const $=h[q]||M[q];$&&$.type==="accessor"&&(N[q]=this.getSubLayerAccessor(N[q]))}}Object.assign(T,e,N),T.id="".concat(this.props.id,"-").concat(S),T.updateTriggers={all:(t=this.props.updateTriggers)===null||t===void 0?void 0:t.all,...e.updateTriggers,...K};for(const M of C){const h=M.getSubLayerProps.call(this,M);h&&Object.assign(T,h,{updateTriggers:Object.assign(T.updateTriggers,h.updateTriggers)})}return T}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let o=this.internalState.subLayers;const s=!o||this.needsUpdate();if(s){const c=this.renderLayers();o=Ln(c,Boolean),this.internalState.subLayers=o}Sn(Cn,this,s,o);for(const c of o)c.parent=this}}Fe(nt,"layerName","CompositeLayer");function Nn({data:i,getIndex:e,dataRange:t,replace:o}){const{startRow:s=0,endRow:c=1/0}=t,u=i.length;let x=u,W=u;for(let g=0;g<u;g++){const L=e(i[g]);if(x>g&&L>=s&&(x=g),L>=c){W=g;break}}let v=x;const w=W-x!==o.length?i.slice(W):void 0;for(let g=0;g<o.length;g++)i[v++]=o[g];if(w){for(let g=0;g<w.length;g++)i[v++]=w[g];i.length=v}return{startRow:x,endRow:x+o.length}}const ot=[0,0,0,255],Pn=[0,0,0,255],En={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:i=>i.polygon},getFillColor:{type:"accessor",value:Pn},getLineColor:{type:"accessor",value:ot},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class Ze extends nt{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&kn.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){const o=this.state.paths.slice(),s=e.dataChanged.map(c=>Nn({data:o,getIndex:u=>u.__source.index,dataRange:c,replace:this._getPaths(c)}));this.setState({paths:o,pathsDiff:s})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:o,positionFormat:s,_normalize:c}=this.props,u=[],x=s==="XY"?2:3,{startRow:W,endRow:v}=e,{iterable:b,objectInfo:w}=zn(t,W,v);for(const g of b){w.index++;let L=o(g,w);c&&(L=sn(L,x));const{holeIndices:j}=L,Z=L.positions||L;if(j)for(let C=0;C<=j.length;C++){const R=Z.slice(j[C-1]||0,j[C]||Z.length);u.push(this.getSubLayerRow({path:R},g,w.index))}else u.push(this.getSubLayerRow({path:Z},g,w.index))}return u}renderLayers(){const{data:e,_dataDiff:t,stroked:o,filled:s,extruded:c,wireframe:u,_normalize:x,_windingOrder:W,elevationScale:v,transitions:b,positionFormat:w}=this.props,{lineWidthUnits:g,lineWidthScale:L,lineWidthMinPixels:j,lineWidthMaxPixels:Z,lineJointRounded:C,lineMiterLimit:R,lineDashJustified:A}=this.props,{getFillColor:X,getLineColor:T,getLineWidth:N,getLineDashArray:K,getElevation:S,getPolygon:M,updateTriggers:h,material:q}=this.props,{paths:$,pathsDiff:ie}=this.state,be=this.getSubLayerClass("fill",dn),se=this.getSubLayerClass("stroke",tt),de=this.shouldRenderSubLayer("fill",$)&&new be({_dataDiff:t,extruded:c,elevationScale:v,filled:s,wireframe:u,_normalize:x,_windingOrder:W,getElevation:S,getFillColor:X,getLineColor:c&&u?T:ot,material:q,transitions:b},this.getSubLayerProps({id:"fill",updateTriggers:h&&{getPolygon:h.getPolygon,getElevation:h.getElevation,getFillColor:h.getFillColor,lineColors:c&&u,getLineColor:h.getLineColor}}),{data:e,positionFormat:w,getPolygon:M}),ce=!c&&o&&this.shouldRenderSubLayer("stroke",$)&&new se({_dataDiff:ie&&(()=>ie),widthUnits:g,widthScale:L,widthMinPixels:j,widthMaxPixels:Z,jointRounded:C,miterLimit:R,dashJustified:A,_pathType:"loop",transitions:b&&{getWidth:b.getLineWidth,getColor:b.getLineColor,getPath:b.getPolygon},getColor:this.getSubLayerAccessor(T),getWidth:this.getSubLayerAccessor(N),getDashArray:this.getSubLayerAccessor(K)},this.getSubLayerProps({id:"stroke",updateTriggers:h&&{getWidth:h.getLineWidth,getColor:h.getLineColor,getDashArray:h.getLineDashArray}}),{data:$,positionFormat:w,getPath:le=>le.path});return[!c&&de,ce,c&&de]}}Fe(Ze,"layerName","PolygonLayer");Fe(Ze,"defaultProps",En);function H(i,e){let t,o;if(e===void 0)for(const s of i)s!=null&&(t===void 0?s>=s&&(t=o=s):(t>s&&(t=s),o<s&&(o=s)));else{let s=-1;for(let c of i)(c=e(c,++s,i))!=null&&(t===void 0?c>=c&&(t=o=c):(t>c&&(t=c),o<c&&(o=c)))}return[t,o]}class Ke extends Map{constructor(e,t=An){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),e!=null)for(const[o,s]of e)this.set(o,s)}get(e){return super.get(He(this,e))}has(e){return super.has(He(this,e))}set(e,t){return super.set(Dn(this,e),t)}delete(e){return super.delete(Rn(this,e))}}function He({_intern:i,_key:e},t){const o=e(t);return i.has(o)?i.get(o):t}function Dn({_intern:i,_key:e},t){const o=e(t);return i.has(o)?i.get(o):(i.set(o,t),t)}function Rn({_intern:i,_key:e},t){const o=e(t);return i.has(o)&&(t=i.get(o),i.delete(o)),t}function An(i){return i!==null&&typeof i=="object"?i.valueOf():i}function Qe(i,e){let t;if(e===void 0)for(const o of i)o!=null&&(t<o||t===void 0&&o>=o)&&(t=o);else{let o=-1;for(let s of i)(s=e(s,++o,i))!=null&&(t<s||t===void 0&&s>=s)&&(t=s)}return t}function Tn(i,e){let t;if(e===void 0)for(const o of i)o!=null&&(t>o||t===void 0&&o>=o)&&(t=o);else{let o=-1;for(let s of i)(s=e(s,++o,i))!=null&&(t>s||t===void 0&&s>=s)&&(t=s)}return t}const et=Symbol("implicit");function re(){var i=new Ke,e=[],t=[],o=et;function s(c){let u=i.get(c);if(u===void 0){if(o!==et)return o;i.set(c,u=e.push(c)-1)}return t[u%t.length]}return s.domain=function(c){if(!arguments.length)return e.slice();e=[],i=new Ke;for(const u of c)i.has(u)||i.set(u,e.push(u)-1);return s},s.range=function(c){return arguments.length?(t=Array.from(c),s):t.slice()},s.unknown=function(c){return arguments.length?(o=c,s):o},s.copy=function(){return re(e,t).unknown(o)},cn.apply(s,arguments),s}function ae(i){var e;function t(o){return o==null||isNaN(o=+o)?e:o}return t.invert=t,t.domain=t.range=function(o){return arguments.length?(i=Array.from(o,Xe),t):i.slice()},t.unknown=function(o){return arguments.length?(e=o,t):e},t.copy=function(){return ae(i).unknown(e)},i=arguments.length?Array.from(i,Xe):[0,1],ln(t)}const Mn=Q("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),In=Q("a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928"),Wn=Q("e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999");var rt=new Array(3).concat("ef8a62f7f7f767a9cf","ca0020f4a58292c5de0571b0","ca0020f4a582f7f7f792c5de0571b0","b2182bef8a62fddbc7d1e5f067a9cf2166ac","b2182bef8a62fddbc7f7f7f7d1e5f067a9cf2166ac","b2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac","b2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac","67001fb2182bd6604df4a582fddbc7d1e5f092c5de4393c32166ac053061","67001fb2182bd6604df4a582fddbc7f7f7f7d1e5f092c5de4393c32166ac053061").map(Q);he(rt);var jn=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(Q);const Fn=he(jn);var Zn=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(Q);const $n=he(Zn);var On=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(Q);const Un=he(On),Ie=[[void 0,void 0],[void 0,void 0]],We={node:{geometry:{extent:Ie},properties:{osmid:void 0,highway:void 0,street_count:void 0}},edge:{geometry:{extent:Ie},properties:{osmid:void 0,capacity:void 0,congestion:void 0,distance:{expected:void 0,observed:void 0,ratio:void 0},highway:void 0,lanes:void 0,length:void 0,maxspeed:void 0,oneway:void 0,traveldemand:{expected:void 0,observed:void 0},traveltime:{expected:void 0,observed:void 0,ratio:void 0,estimated:void 0}}},zone:{geometry:{extent:Ie},properties:{lane_capacity_total:void 0,lane_length:void 0,node_count:void 0,traveldemand:{incoming:void 0,outgoing:void 0,delta:void 0}}}},je={node:{position:void 0,color:void 0,size:void 0,label:void 0},edge:{position:void 0,color:void 0,size:void 0,label:void 0},zone:{position:void 0,color:void 0,size:void 0,label:void 0}};const Bn={class:"tools"},Gn=["id","onUpdate:modelValue","disabled"],Vn=["for"],oo={__name:"NetworkView",props:{networkId:{type:String,required:!0},modelId:{type:String,required:!1},traveltimeId:{type:String,required:!1},traveldemandId:{type:String,required:!1}},setup(i){const e=i;Re.accessToken="pk.eyJ1IjoiZmlsb25pay10dWQiLCJhIjoiY2xhbDl5YTQ4MDM5NDNvcXZtcGZjbjBicCJ9.gL_9d4Ij6g9PaSWKOuhhKw";const t={latitude:47.1744,longitude:37.4411,zoom:12,bearing:0,pitch:0},o=Gt(),s=rn(),c=Vt(null),u=async n=>{const r=await fn(n.network);return r.every((a,d)=>{const f=a.geometry,p=[f.coordinates];f.extent=[H(p,l=>l[0]),H(p,l=>l[1])];const m=a.properties;return m.street_count=m.street_cou,delete m.street_cou,!0}),r},x=async n=>{const r=await pn(n.network);return r.every((a,d)=>{const f=a.geometry,p=f.coordinates;f.extent=[H(p,l=>l[0]),H(p,l=>l[1])];const m=a.properties;return m.oneway=!!m.oneway,!0}),r&&n.model&&await mn(n.model,r),r&&n.traveltime&&await yn(n.traveltime,r),r},W=async n=>{const r=await hn(n.network);return r.every((a,d)=>{const f=a.geometry,p=f.coordinates.flat(1);return f.extent=[H(p,m=>m[0]),H(p,m=>m[1])],!0}),r&&n.model&&await bn(n.model,r),r&&n.traveldemand&&await vn(n.traveldemand,r),r},v=n=>r=>Qt(n,r),b=n=>r=>r.map(n),w=b(V)(Mn),g=b(V)(Wn),L=b(V)(In),j=b(b(V))(rt),Z=v(V)(Un),C=v(V)($n),R=v(V)(Fn),A=v(V)(un),X=v(V)(gn),T=[127,127,127],N={node:{size:[3,30]},edge:{size:[2,20]},zone:{size:[0,1]}},K=N.node.size,S=N.edge.size,M=N.zone.size,h="motorway_link|motorway|trunk_link|trunk|primary_link|primary|secondary_link|secondary|tertiary_link|tertiary|road".split("|"),q=[20,100],$=[0,5e3],ie=[500,1500],be=[2,.5],se=[3,1.5,.75],de=[-1e3,0,1e3],ce=re(w),le=re([j[5][0],j[5][4]]).domain([!0,!1]),at=y(R).domain([0,1]),ve=()=>[[ae(),ae()],[ae(),ae()]],we=n=>({text:Array.isArray(n)?n.join(", "):n}),k={node:{position:{geometry:{extent:ve()}},color:{properties:{highway:re(g).unknown(T),street_count:y(X)}},size:{properties:{street_count:z().range(K)}},label:{properties:{osmid:we}}},edge:{position:{geometry:{extent:ve()}},color:{properties:{capacity:y(C).domain(ie),congestion:y(A).domain(se),distance:{expected:y(R).domain($),observed:y(R).domain($),ratio:y(A).domain(be)},highway:re(L).domain(h).unknown(T),lanes:y(R),length:y(R).domain($),maxspeed:y(Z).domain(q),oneway:le,traveldemand:{expected:y(A),observed:y(A)},traveltime:{expected:y(A),observed:y(A),ratio:Me(A).domain(se),estimated:le}}},size:{properties:{capacity:z().range(S),congestion:z().range(S),lanes:z().range(S),length:z().range(S),maxspeed:z().range(S),traveltime:{expected:z().range(S),observed:z().range(S),ratio:z().range(S)}}},label:{properties:{osmid:we,name:we}}},zone:{position:{geometry:{extent:ve()}},color:{properties:{lane_capacity_total:y(C),lane_length:y(R),node_count:y(X),traveldemand:{incoming:y(C),outgoing:y(Z),delta:Me(A).domain(de)}}},size:{properties:{lane_capacity_total:z().range(M),lane_length:z().range(M),node_count:z().range(M),traveldemand:{incoming:z().range(M),outgoing:z().range(M),delta:Me().range([1,0,1])}}},label:{properties:{}}}},it=n=>nn(n).filter(on),st=n=>it(n).sort(),O=H,J=n=>r=>[n,Qe(r)],ue=(n=>r=>{const[a,d]=n(r);return[d,a]})(O),P=n=>r=>{const a=n(r);return d=>d.domain(a)},U=n=>r=>{const a=n(r);return d=>d.domain(a).nice()},_e=[[P(O),P(O)],[P(O),P(O)]],xe={node:{geometry:{extent:_e},properties:{osmid:void 0,highway:P(st),street_count:P(J(0))}},edge:{geometry:{extent:_e},properties:{osmid:void 0,capacity:P(O),congestion:P(O),distance:{expected:U(J(0)),observed:U(J(0)),ratio:void 0},highway:void 0,lanes:P(J(0)),length:U(J(0)),maxspeed:P(J(0)),oneway:void 0,traveldemand:{expected:U(ue),observed:U(ue)},traveltime:{expected:U(ue),observed:U(ue),ratio:void 0,estimated:void 0}}},zone:{geometry:{extent:_e},properties:{lane_capacity_total:P(O),lane_length:P(O),node_count:P(O),traveldemand:{incoming:U(J(0)),outgoing:U(J(0)),delta:void 0}}}},Le=(n,r)=>(a,d)=>f=>{for(let p of Ye(n)){const m=tn(p),l=f.map(m),D=m(d);if(l&&D){const G=D(l);for(let Ee of Ye(r)){const De=oe(oe(a,Ee),p);De&&G(De)}}}},dt=Le(We.node,je.node)(k.node,xe.node),ct=Le(We.edge,je.edge)(k.edge,xe.edge),lt=Le(We.zone,je.zone)(k.zone,xe.zone),$e=n=>(r,a)=>ye(n),Se=(n,r)=>{const a=r%10,d=ce(a);return ye(d)},ke=(n,r)=>(a,d)=>{const f=d%10;return ce(f)},ze=(n,r)=>{const d=n.geometry.coordinates.length;return(f,p)=>at(p/d)},ut=(n,r)=>{let a=n.properties;return a=JSON.stringify(a,null,2),ye({html:`<pre>${a}</pre>`})},ge=$e([255,255,255]),fe=$e(1),Ce=ut,Y=n=>r=>{const a=oe(n,r);return(d,f)=>{const p=oe(d,r);return ye(a(p))}},Oe=Y(k.node.color),gt=Y(k.node.size),ft=Y(k.node.label),_=Y(k.edge.color),pt=Y(k.edge.size),Ue=Y(k.edge.label),ee=Y(k.zone.color),te=Y(k.zone.size),Ne={node:{color:{coordinate:{index:ke,domain:ze},feature:{index:Se},highway:Oe("properties.highway"),street_count:Oe("properties.street_count")},size:{street_count:gt("properties.street_count")},label:{osmid:ft("properties.osmid")}},edge:{color:{coordinate:{index:ke,domain:ze},feature:{index:Se},capacity:_("properties.capacity"),congestion:_("properties.congestion"),distance:{expected:_("properties.distance.expected"),observed:_("properties.distance.observed"),ratio:_("properties.distance.ratio")},highway:_("properties.highway"),length:_("properties.length"),maxspeed:_("properties.maxspeed"),oneway:_("properties.oneway"),traveldemand:{expected:_("properties.traveldemand.expected"),observed:_("properties.traveldemand.observed")},traveltime:{expected:_("properties.traveltime.expected"),observed:_("properties.traveltime.observed"),ratio:_("properties.traveltime.ratio"),estimated:_("properties.traveltime.estimated")}},size:{lanes:pt("properties.lanes")},label:{osmid:Ue("properties.osmid"),name:Ue("properties.name")}},zone:{color:{coordinate:{index:ke,domain:ze},feature:{index:Se},lane_capacity_total:ee("properties.lane_capacity_total"),lane_length:ee("properties.lane_length"),node_count:ee("properties.node_count"),traveldemand:{incoming:ee("properties.traveldemand.incoming"),outgoing:ee("properties.traveldemand.outgoing"),delta:ee("properties.traveldemand.delta")}},size:{lane_capacity_total:te("properties.lane_capacity_total"),lane_length:te("properties.lane_length"),node_count:te("properties.node_count"),traveldemand:{incoming:te("properties.traveldemand.incoming"),outgoing:te("properties.traveldemand.outgoing"),delta:te("properties.traveldemand.delta")}},label:{}}},B=n=>{let r=o.query[n];return r=r||"default",oe(Ne,`${n}.${r}`)},mt=ge,yt=e.modelId||e.traveltimeId?Ne.edge.color.traveltime.ratio:ge,ht=e.modelId||e.traveldemandId?Ne.zone.color.traveldemand.delta:ge,bt=B("node.color")??mt,vt=B("node.size")??fe,wt=B("node.label")??Ce,_t=B("edge.color")??yt,xt=B("edge.size")??fe,Lt=B("edge.label")??Ce,Be=B("zone.color")??ht,Ge=B("zone.size")??fe,St=B("zone.label")??Ce,Ve=Ge!==fe,kt=Be!==ge,zt=(n=>{const r=Ve?255:kt?63:31;return(a,d)=>(f,p)=>[...n(a,d)(f,p),r]})(Be),Ct=n=>n.map((a,d)=>({position:a.geometry.coordinates,color:bt(a,d)(void 0,0),size:vt(a,d)(void 0,0)})),Nt=n=>n.map((a,d)=>({position:a.geometry.coordinates,color:zt(a,d)(void 0,0),size:Ge(a,d)(void 0,0)})),Pt=n=>{const r=n.map(I=>I.geometry.coordinates),a=n.map((I,ne)=>I.geometry.coordinates.map(_t(I,ne))),d=n.map((I,ne)=>I.geometry.coordinates.map(xt(I,ne))),f=r[0]?.[0]?.length??2,p=a[0]?.[0]?.length??3,m=1,l=new Float32Array(r.flat(2)),D=new Uint8Array(a.flat(2)),G=new Uint8Array(d.flat(1)),Ee=new Uint32Array(n.reduce((I,ne)=>{const Ot=ne.geometry.coordinates,Ut=I[I.length-1],Bt=Ot.length;return I.push(Ut+Bt),I},[0]));return{length:n.length,startIndices:Ee,attributes:{getPath:{value:l,size:f},getColor:{value:D,size:p},getWidth:{value:G,size:m}}}},Et=async n=>{const r=await u(n);return dt(r),{features:r}},Dt=async n=>{const r=await x(n);return ct(r),{features:r}},Rt=async n=>{const r=await W(n);return lt(r),{features:r}},At=n=>{const r=Ct(n.features);return new _n({id:"nodes",data:r,pickable:!0,stroked:!0,filled:!0,radiusMinPixels:K[0],radiusMaxPixels:K[1],lineWidthMinPixels:1,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,getLineWidth:1,getPosition:d=>d.position,getFillColor:d=>d.color,getLineColor:[80,80,80],getRadius:d=>d.size})},Tt=n=>{const r=Nt(n.features);return new Ze({id:"zones",data:r,pickable:!0,stroked:!0,filled:!0,extruded:Ve,elevationScale:1e4,wireframe:!0,lineWidthMinPixels:1,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,getLineWidth:1,getPolygon:d=>d.position,getFillColor:d=>d.color,getLineColor:[80,80,80],getElevation:d=>d.size})},Mt=n=>{const r=Pt(n.features);return new tt({id:"edges",data:r,widthScale:1,widthMinPixels:S[0],widthMaxPixels:S[1],pickable:!0,_pathType:"open"})};let pe;const F={nodes:null,edges:null,zones:null},E=qt({layers:{nodes:{title:"Nodes",count:0,enabled:!1,visible:!1},edges:{title:"Edges",count:0,enabled:!1,visible:!1},zones:{title:"Zones",count:0,enabled:!1,visible:!1}}}),It=["zones","edges","nodes"],Wt=()=>{if(pe&&F){const n=It.map(r=>F[r]).filter(r=>r&&E.layers[r.id].enabled).map(r=>r.clone({visible:E.layers[r.id].visible}));pe.setProps({layers:n})}},jt=n=>Tn(n.domain()),Ft=n=>Qe(n.domain()),Zt=n=>[jt(n[0]),Ft(n[1])],$t=n=>n.map(Zt),Pe=n=>$t(n).map(en);return Jt(()=>E.layers,(n,r)=>{Wt()},{deep:!0}),Yt(async()=>{let n,r,a;s.value=e.networkId;const d={network:`/data/networks/${e.networkId}`,model:e.modelId?`/data/networks/${e.networkId}/models/${e.modelId}`:void 0,traveltime:e.traveltimeId?`/data/networks/${e.networkId}/traveltimes/${e.traveltimeId}`:void 0,traveldemand:e.traveldemandId?`/data/networks/${e.networkId}/traveldemands/${e.traveldemandId}`:void 0};try{n=await Et(d),F.nodes=At(n)}catch(l){console.error("Error loading nodes.",l)}try{r=await Dt(d),F.edges=Mt(r)}catch(l){console.error("Error loading edges.",l)}try{a=await Rt(d),F.zones=Tt(a)}catch(l){console.error("Error loading zones.",l)}const f=l=>{if(l.picked){if(F.nodes&&F.nodes.id==l.layer.id){const D=l.index,G=n.features[D];return wt(G,D)(void 0,0)}if(F.edges&&F.edges.id==l.layer.id){const D=l.index,G=r.features[D];return Lt(G,D)(void 0,0)}if(F.zones&&F.zones.id==l.layer.id){const D=l.index,G=a.features[D];return St(G,D)(void 0,0)}}};let p=()=>n?Pe(k.node.position.geometry.extent):r?Pe(k.edge.position.geometry.extent):a?Pe(k.zone.position.geometry.extent):[t.longitude,t.latitude];pe=new wn({layers:[],getTooltip:f});const m=new Re.Map({container:c.value,projection:{name:"mercator"},style:an.DARK_MATTER_NOLABELS,center:p(),bearing:t.bearing,pitch:t.pitch,zoom:t.zoom});m.addControl(pe),m.addControl(new Re.NavigationControl),E.layers.nodes.enabled=!!n,E.layers.nodes.visible=!!n,E.layers.nodes.count=n?.features?.length??0,E.layers.edges.enabled=!!r,E.layers.edges.visible=!!r,E.layers.edges.count=r?.features?.length??0,E.layers.zones.enabled=!!a,E.layers.zones.visible=!!a,E.layers.zones.count=a?.features?.length??0}),(n,r)=>(Ae(),Te(qe,null,[me("div",Bn,[(Ae(!0),Te(qe,null,Xt(E.layers,(a,d)=>(Ae(),Te("div",{key:d},[Kt(me("input",{type:"checkbox",id:d,"onUpdate:modelValue":f=>a.visible=f,disabled:!a.enabled},null,8,Gn),[[Ht,a.visible]]),me("label",{for:d},Je(a.title)+" ("+Je(a.count)+")",9,Vn)]))),128))]),me("div",{class:"map",ref_key:"containerRef",ref:c},null,512)],64))}};export{oo as default};
