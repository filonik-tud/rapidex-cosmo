import{o as f,c as x,a as o,r as Ce,n as Re,g as Ie,u as U,_ as Ne,b as R,d as J,e as v,t as p,f as Q,i as Ue,m as X,h as D,j as ee,w as Pe,k as A,l as te,p as oe,q as h,v as E,s as Fe,F as Be,x as Ge,y as I,z as Ze,A as je,B as Ye,C as se,D as ae,E as ne,G as We}from"./index.7a4453cf.js";import{u as $e,M as ie,B as N}from"./mapbox-layer.23573ae4.js";import{u as le}from"./useDeckGL.c152290a.js";import{P as qe,S as He,s as Ke,l as Je,d as re,a as Qe,b as Xe,c as et,R as tt,m as ot,r as de}from"./loaders.3c5b3ddb.js";import{m as ce,a as ue}from"./objects.1ec32615.js";import{u as st,a as at}from"./propsExternal.2c2153d4.js";import{r as nt}from"./HomeIcon.aee6e485.js";import"./layer.6384b77b.js";import"./phong-lighting.adf0dbf3.js";const it="/assets/congestion-white.b6a18e38.png",lt="/assets/emissions-white.02b0855c.png",rt="/assets/orbit-alt-white.92eaee96.png",dt="/assets/cars-arrow-down-white.5ca367c8.png",ct="/assets/cars-arrow-up-white.ad9d25cc.png";function ut(b,g){return f(),x("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"})])}const pe={__name:"ToggleButton",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(b,{emit:g}){const y=$e(b,"modelValue",g),L=()=>{y.value=!y.value};return(S,T)=>(f(),x("button",{onClick:L},[Ce(S.$slots,"default",Re(Ie({value:U(y)})))]))}},pt=(b,g)=>k=>b(g(k)),m=b=>(Ze("data-v-24725cde"),b=b(),je(),b),mt={class:"flex-grow flex flex-row"},vt={class:"flex-grow flex flex-col"},bt={key:0,class:"flex flex-row h-8 p-2 bg-slate-700 text-slate-400 items-center"},gt={class:"flex-grow bg-slate-200 relative"},ht={class:"absolute top-0 left-0 p-4"},yt={class:"absolute top-0 left-1/2 transform -translate-x-1/2 text-slate-200"},ft={class:"flex flex-row items-center my-6 gap-4"},xt={class:"text-4xl px-4"},_t={class:"opacity-50 hover:opacity-100","data-modal-toggle":"modal","data-modal-target":"modal",type:"button"},wt={class:"absolute top-0 right-0 px-2 py-6 mt-24"},kt={class:"flex flex-col items-center gap-4"},Lt=m(()=>o("img",{class:"h-9 w-9 opacity-75 hover:opacity-100",src:rt,alt:"Orbit"},null,-1)),zt=[Lt],Dt={class:"flex flex-row h-16 p-2 bg-slate-700 items-center overflow-hidden"},St=m(()=>o("img",{class:"h-14 w-14",src:dt,alt:"Nachfrage Reduzieren"},null,-1)),Vt=[St],At=["min","max","step"],Et=m(()=>o("img",{class:"h-14 w-14",src:ct,alt:"Nachfrage Erhoehen"},null,-1)),Tt=[Et],Mt={id:"modal",tabindex:"-1","aria-hidden":"true",class:"fixed top-0 left-0 right-0 z-50 hidden w-full p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] md:h-full"},Ot={class:"relative w-full h-full max-w-2xl md:h-auto"},Ct={class:"relative bg-white rounded-lg shadow dark:bg-gray-700"},Rt={class:"flex items-start justify-between p-5 border-b rounded-t dark:border-gray-600"},It=["textContent"],Nt=m(()=>o("button",{id:"closeButton","data-modal-hide":"modal",type:"button",class:"text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white"},[o("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},[o("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})])],-1)),Ut={class:"p-6 space-y-6"},Pt=["textContent"],Ft={key:0,class:"flex flex-col gap-y-2 h-full w-64 bg-slate-400 p-2 overflow-hidden"},Bt=m(()=>o("h4",null,"General",-1)),Gt=["value"],Zt=m(()=>o("h4",null,"Nodes",-1)),jt=["disabled"],Yt=m(()=>o("label",{class:"m-2",for:"checkbox"},"Visible",-1)),Wt=m(()=>o("h4",null,"Links",-1)),$t=["disabled"],qt=m(()=>o("label",{class:"m-2",for:"checkbox"},"Visible",-1)),Ht=m(()=>o("h4",null,"Zones",-1)),Kt=["disabled"],Jt=m(()=>o("label",{class:"m-2",for:"checkbox"},"Visible",-1)),Qt=m(()=>o("div",{class:"flex justify-center p-4"},[o("button",{id:"button","data-modal-toggle":"modal","data-modal-target":"modal",type:"button",class:"text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800"}," Show Info ")],-1)),Xt={__name:"CosmoView",props:{networkId:{type:String,required:!0},modelId:{type:String,required:!1}},setup(b){const g=b,k=R(!1),y={position:[0,0],color:[1,1,1,1],size:1,value:0},L={position:[0,0],color:[1,1,1,.1],size:1,value:0},S=[1,2],T={overlay:!1,interleaved:!1,preserveDrawingBuffer:!1,useWebGL2:!0},_={projection:"mercator",style:"mapbox://styles/mapbox/dark-v11",viewState:{longitude:13.79,latitude:51.07,zoom:11,pitch:0,bearing:0}},P=R(null),l=J({values:[{nodes:{meta:{},data:[]},links:{meta:{},data:[]},zones:{meta:{},data:[]}}],progress:{min:0,max:100,step:.1,value:50},index:{value:v(()=>{const e=l.progress,t=e.max-e.min,s=e.value-e.min,n=l.values.length-1;return Math.trunc(n*(s/t))})},currentValue:v(()=>l.values[l.index.value]),currentNodeMeta:v(()=>l.currentValue.nodes.meta),currentNodeData:v(()=>l.currentValue.nodes.data),currentLinkMeta:v(()=>l.currentValue.links.meta),currentLinkData:v(()=>l.currentValue.links.data),currentZoneMeta:v(()=>l.currentValue.zones.meta),currentZoneData:v(()=>l.currentValue.zones.data)}),me={_pathType:"open",widthScale:10,widthMinPixels:3,widthMaxPixels:100,visible:!0},ve={pickable:!0,extruded:!1,elevationScale:1e4,_normalize:!1,visible:!0},be=[st(Ye.exports.NavigationControl)],u={nodes:{instance:void 0,props:{}},links:{instance:void 0,props:{}},zones:{instance:void 0,props:{}}};u.links=le(ie,{...me,type:qe,id:"edge-layer",data:p(l,"currentLinkData")}),u.zones=le(ie,{...ve,type:He,id:"zone-layer",data:p(l,"currentZoneData")});const ge=(e,t)=>{const s=t.find(r=>r.type==="symbol").id,n=15;e.addLayer({id:"3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:n,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["interpolate",["linear"],["zoom"],n,0,n+.05,["get","height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],n,0,n+.05,["get","min_height"]],"fill-extrusion-opacity":.6}},s)},he=(e,t)=>{for(const s of t)s.type==="symbol"&&s.layout["text-field"]&&e.removeLayer(s.id)},z=at({container:P,projection:_.projection,style:_.style,viewState:{..._.viewState},controls:be,on:{load:()=>{const e=z.instance.value,t=e.getStyle().layers;ge(e,t),he(e,t),e.addLayer(u.zones.instance.value),e.addLayer(u.links.instance.value)}},preserveDrawingBuffer:T.preserveDrawingBuffer,useWebGL2:T.useWebGL2}),a=J({info:{},options:{style:{options:[{title:"Dark Matter",value:N.DARK_MATTER_NOLABELS},{title:"Positron",value:N.POSITRON_NOLABELS},{title:"Voyager",value:N.VOYAGER_NOLABELS},{title:"Mapbox Light",value:"mapbox://styles/mapbox/light-v11"},{title:"Mapbox Dark",value:"mapbox://styles/mapbox/dark-v11"}],value:p(z.props,"style")},nodes:{visible:{label:"Visible",value:p(u.nodes.props,"visible")},disabled:{value:v(()=>!l.currentNodeData)}},links:{width:{scale:{value:p(u.links.props,"widthScale")},pixels:{range:{0:p(u.links.props,"widthMinPixels"),1:p(u.links.props,"widthMaxPixels")}},minPixels:{value:p(u.links.props,"widthMinPixels")},maxPixels:{value:p(u.links.props,"widthMaxPixels")}},filter:{min:0,max:9,step:.01,range:p(u.links.props,"filterRange")},visible:{label:"Visible",value:p(u.links.props,"visible")},disabled:{value:v(()=>!l.currentLinkData)}},zones:{visible:{label:"Visible",value:p(u.zones.props,"visible")},disabled:{value:v(()=>!l.currentZoneData)}}},animateOrbit:!1,animateTimeline:!1,progress:p(l,"progress")}),ye={position:e=>["getPath",{value:new Float32Array(e.flat(2)),size:e[0]?.[0]?.length??2}],color:e=>["getColor",{value:new Float32Array(e.flat(2)),size:e[0]?.[0]?.length??4}],size:e=>["getWidth",{value:new Float32Array(e.flat(1)),size:1}],value:e=>["getFilterValue",{value:new Float32Array(e.flat(1)),size:1}]},fe={position:e=>["getPolygon",{value:new Float32Array(e.flat(3)),size:e[0]?.[0]?.[0]?.length??2}],color:e=>["getFillColor",{value:new Float32Array(e.flat(3)),size:e[0]?.[0]?.[0]?.length??4}],size:e=>["getElevation",{value:new Float32Array(e.flat(2)),size:1}],value:e=>["getFilterValue",{value:new Float32Array(e.flat(2)),size:1}]},F=ce(([e,t])=>ye[e](t)),B=ce(([e,t])=>fe[e](t)),G=e=>t=>ue(n=>e.map((r,i)=>r.geometry.coordinates.map(n(r,i))))(t),Z=e=>t=>ue(n=>e.map((r,i)=>r.geometry.coordinates.map((d,w)=>d.map(n(r,i)))))(t),xe=e=>t=>{const s=G(e)(t),n=new Uint32Array(e.reduce((i,d)=>{const w=d.geometry.coordinates,V=i[i.length-1],C=w.length;return i.push(V+C),i},[0]));return{length:e.length,startIndices:n,attributes:F(s)}},_e=e=>t=>{const s=Z(e)(t),n=new Uint32Array(e.reduce((i,d)=>(d.geometry.coordinates.forEach((w,V)=>{const C=i[i.length-1],Oe=w.length;i.push(C+Oe)}),i),[0]));return{length:e.length,startIndices:n,attributes:B(s)}},j=e=>t=>({...e,attributes:{...e.attributes,...t}}),we=e=>t=>s=>{const n=G(t)(s);return j(e)(F(n))},ke=e=>t=>s=>{const n=Z(t)(s);return j(e)(B(n))},Y=e=>t=>pt(e,t),W=Y(de)(tt),Le=Y(de)(ot),ze=[3,1.5,.75],$=[0,5e4],De=Ke(Le).domain($),Se=Je().range([.1,.4]).domain($),q={colors:{emissions:((e,t)=>s=>{const n=e(s),r=t(s);return[n[0],n[1],n[2],r]})(De,Se),volume_capacity:re(W).domain([S[1],S[0],0]),traveltime:{ratio:re(W).domain(ze)}}};R(null);const H={nodes:{},links:{color:{volume_capacity:({modelId:e,assignmentId:t})=>s=>{const n=s.properties.models[e].assignments[t].volume_capacity.ratio,r=q.colors.volume_capacity(n);return i=>r}}},zones:{color:{emissions:({modelId:e,assignmentId:t})=>s=>{const n=s.properties.models[e].assignments[t].emissions,r=q.colors.emissions(n);return i=>r}}}};Q(()=>{Ue()}),Q(async()=>{a.info=await Qe(`/data/networks/${g.networkId}/info.json`),_.viewState.longitude=(a.info.bounds[0]+a.info.bounds[2])/2,_.viewState.latitude=(a.info.bounds[1]+a.info.bounds[3])/2,O();const e=await Xe(g),t=void 0,s=xe(e.links)({position:i=>d=>d,color:i=>d=>y.color,size:i=>d=>y.size,value:i=>d=>y.value}),n=_e(e.zones)({position:i=>d=>d,color:i=>d=>L.color,size:i=>d=>L.size,value:i=>d=>L.value});l.values=X([{nodes:{meta:{},data:t},links:{meta:{},data:s},zones:{meta:{},data:n}}]);const r=[];for await(const i of et(g,e)){const w=we(s)(e.links)({color:H.links.color.volume_capacity(i)}),V=ke(n)(e.zones)({color:H.zones.color.emissions(i)});r.push({nodes:{meta:{},data:void 0},links:{meta:{},data:w},zones:{meta:{},data:V}}),l.values=X(r)}console.log("Loaded",g)});const Ve={to:[50,100,50,0,50],duration:15e3,ease:[ae,ne,ae,ne],repeat:1/0,repeatDelay:500,repeatType:"mirror",onUpdate:e=>{l.progress.value=e}};let M;const Ae={from:0,to:1,duration:12e4,ease:We,repeat:1/0,onPlay:()=>{M=z.viewState.value},onUpdate:e=>{const t=M.bearing+e*1e3%360;z.viewState.value={...M,bearing:t}}},c={orbit:{playback:void 0,play:()=>{c.orbit.playback||(c.orbit.playback=se(Ae))},stop:()=>{c.orbit.playback&&(c.orbit.playback.stop(),c.orbit.playback=void 0)}},timeline:{playback:void 0,play:()=>{c.timeline.playback||(c.timeline.playback=se(Ve))},stop:()=>{c.timeline.playback&&(c.timeline.playback.stop(),c.timeline.playback=void 0)}}},K=()=>{a.animateOrbit=!a.animateOrbit,a.animateOrbit?c.orbit.play():c.orbit.stop()},Ee=()=>{a.animateTimeline=!a.animateTimeline,a.animateTimeline?c.timeline.play():c.timeline.stop()},Te=()=>{const e=a.progress.value-a.progress.step*50;a.progress.value=Math.max(e,a.progress.min)},Me=()=>{const e=a.progress.value+a.progress.step*50;a.progress.value=Math.min(e,a.progress.max)},O=()=>{z.props.viewState={..._.viewState}};return(e,t)=>(f(),x("div",mt,[o("div",vt,[k.value?(f(),x("aside",bt,[o("pre",null,D(l.currentLinkMeta.path),1)])):ee("",!0),o("main",gt,[o("div",{class:"bg-stone-800 h-full w-full",ref_key:"containerRef",ref:P,onContextmenu:t[0]||(t[0]=Pe(()=>{},["prevent"]))},null,544),o("div",ht,[A(pe,{class:"mx-4",modelValue:a.options.links.visible.value,"onUpdate:modelValue":t[1]||(t[1]=s=>a.options.links.visible.value=s)},{default:te(({value:s})=>[o("img",{class:oe(["h-16 w-16 hover:opacity-100",[s?"opacity-75":"opacity-25"]]),src:it,alt:"Verkehrsbelastung"},null,2)]),_:1},8,["modelValue"]),A(pe,{class:"mx-2 hover:opacity-100",modelValue:a.options.zones.visible.value,"onUpdate:modelValue":t[2]||(t[2]=s=>a.options.zones.visible.value=s)},{default:te(({value:s})=>[o("img",{class:oe(["h-16 w-16 hover:opacity-100",[s?"opacity-75":"opacity-25"]]),src:lt,alt:"Emissionen"},null,2)]),_:1},8,["modelValue"])]),o("div",yt,[o("div",ft,[o("h1",xt,D(a.info.title),1),o("button",_t,[A(U(ut),{class:"text-white h-10 w-10"})])])]),o("div",wt,[o("div",kt,[o("button",{class:"opacity-50 hover:opacity-100",onClick:O,type:"button"},[A(U(nt),{class:"text-white h-8 w-8"})]),o("button",{class:"opacity-50 hover:opacity-100",onClick:K,type:"button"},zt)])])]),o("aside",Dt,[o("button",{class:"opacity-50 hover:opacity-100",onClick:Te,type:"button"},Vt),h(o("input",{class:"flex-grow mx-2 slider",type:"range","onUpdate:modelValue":t[3]||(t[3]=s=>a.progress.value=s),min:a.progress.min,max:a.progress.max,step:a.progress.step},null,8,At),[[E,a.progress.value,void 0,{number:!0}]]),o("button",{class:"opacity-50 hover:opacity-100",onClick:Me,type:"button"},Tt)]),o("div",Mt,[o("div",Ot,[o("div",Ct,[o("div",Rt,[o("h3",{class:"text-xl font-semibold text-gray-900 lg:text-2xl dark:text-white",textContent:D(a.info.title)},null,8,It),Nt]),o("div",Ut,[o("p",{class:"text-base leading-relaxed text-gray-500 dark:text-gray-400",textContent:D(a.info.description)},null,8,Pt)])])])])]),k.value?(f(),x("aside",Ft,[Bt,h(o("select",{class:"mx-2","onUpdate:modelValue":t[4]||(t[4]=s=>a.options.style.value=s)},[(f(!0),x(Be,null,Ge(a.options.style.options,s=>(f(),x("option",{value:s.value},D(s.title),9,Gt))),256))],512),[[Fe,a.options.style.value]]),o("button",{class:"btn mx-2",onClick:Ee},"Timeline"),o("button",{class:"btn mx-2",onClick:K},"Orbit"),o("button",{class:"btn mx-2",onClick:O},"Reset"),Zt,o("div",null,[h(o("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=s=>a.options.nodes.visible.value=s),disabled:a.options.nodes.disabled.value},null,8,jt),[[I,a.options.nodes.visible.value]]),Yt]),Wt,h(o("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=s=>a.options.links.width.scale.value=s)},null,512),[[E,a.options.links.width.scale.value,void 0,{number:!0}]]),h(o("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=s=>a.options.links.width.pixels.range[0]=s)},null,512),[[E,a.options.links.width.pixels.range[0],void 0,{number:!0}]]),h(o("input",{type:"number","onUpdate:modelValue":t[8]||(t[8]=s=>a.options.links.width.pixels.range[1]=s)},null,512),[[E,a.options.links.width.pixels.range[1],void 0,{number:!0}]]),o("div",null,[h(o("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=s=>a.options.links.visible.value=s),disabled:a.options.links.disabled.value},null,8,$t),[[I,a.options.links.visible.value]]),qt]),Ht,o("div",null,[h(o("input",{type:"checkbox","onUpdate:modelValue":t[10]||(t[10]=s=>a.options.zones.visible.value=s),disabled:a.options.zones.disabled.value},null,8,Kt),[[I,a.options.zones.visible.value]]),Jt]),Qt])):ee("",!0)]))}},po=Ne(Xt,[["__scopeId","data-v-24725cde"]]);export{po as default};
